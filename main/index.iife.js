var u=Object.defineProperty;var d=(e,n,t)=>n in e?u(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var l=(e,n,t)=>d(e,typeof n!="symbol"?n+"":n,t);(function(){"use strict";new class{constructor(){l(this,"o",null)}getRequestHeader(){const e=this.i("gf-token-production");return e?{"Content-Type":"application/json",headers:{authorization:"Bearer "+e}}:{}}u(e){return new Promise(n=>{const t=()=>{setTimeout(()=>{document.getElementById(e)?n():t()},200)};t()})}waitUntilTime(e){return new Promise(n=>{const t=Date.now(),o=e-t;o<=0?n():setTimeout(n,o)})}t(){chrome.runtime.sendMessage(window.ghExtensionId,{isLobby:!0},n=>{if(n.shouldLogin)try{this.waitUntilTime(n.loginDelay).then(()=>this.l(n))}catch{}});const{fetch:e}=window;window.fetch=async(...n)=>{var s;const[t,o]=n;return t.url&&t.url.indexOf("loginLink")>0&&this.o?((s=t.body)==null||s.getReader().read().then(({value:r})=>{const c=JSON.parse(new TextDecoder().decode(r)),i={server:{number:this.o.server,language:this.o.language},id:this.o.playerId,clickedButton:"account_list",blackbox:c.blackbox};this.o=null,this.h(i)}),null):e(t,o)}}h(e){const n=`/api/users/me/loginLink?id=${e.id}&server[language]=${e.server.language}&server[number]=${e.server.number}&clickedButton=account_list&blackbox=${encodeURIComponent(e.blackbox)}`,t=this.i("gf-token-production");t&&fetch(n,{headers:{"Content-Type":"application/json",authorization:"Bearer "+t}}).then(o=>o.json()).then(o=>{if(o&&o.url){const s=document.createElement("script");s.textContent="window.onbeforeunload = null;",(document.head||document.documentElement).appendChild(s),s.remove(),window.location.href=o.url}else chrome.runtime.sendMessage(window.ghExtensionId,{loginFailed:!0})})}i(e){const n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():""}async l(e){var n;if(window.location.href.indexOf("accounts")<0)window.location.href="https://lobby.gladiatus.gameforge.com/en_GB/accounts";else{const t="/api/users/me/accounts",o=await fetch(t,this.getRequestHeader()),s=(n=await o.json())==null?void 0:n.sort((i,a)=>new Date(a.lastLogin).getTime()-new Date(i.lastLogin).getTime());let r=0,c=!1;for(let i=0;i<s.length;i++){const a=s[i];if(a.server.number==e.server&&a.id==e.playerId&&a.server.language==e.language){r=i,c=!0;break}}if(c){await this.u("accountlist");const i=document.getElementById("accountlist").getElementsByClassName("btn btn-primary")[r];this.o=e,i.click()}}}}().t()})();
